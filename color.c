#include"image.h"

const struct{
  uint32_t code;
  char escape[16];
}color[]=
  {
    {0x000000,"\e[38;5;0m"},
    {0xcd0000,"\e[38;5;1m"},
    {0x00cd00,"\e[38;5;2m"},
    {0xcdcd00,"\e[38;5;3m"},
    {0x0000ee,"\e[38;5;4m"},
    {0xcd00cd,"\e[38;5;5m"},
    {0x00cdcd,"\e[38;5;6m"},
    {0xe5e5e5,"\e[38;5;7m"},
    {0x7f7f7f,"\e[38;5;8m"},
    {0xff0000,"\e[38;5;9m"},
    {0x00ff00,"\e[38;5;10m"},
    {0xffff00,"\e[38;5;11m"},
    {0x5c5cff,"\e[38;5;12m"},
    {0xff00ff,"\e[38;5;13m"},
    {0x00ffff,"\e[38;5;14m"},
    {0xffffff,"\e[38;5;15m"},
    {0x000000,"\e[38;5;16m"},
    {0x00005f,"\e[38;5;17m"},
    {0x000087,"\e[38;5;18m"},
    {0x0000af,"\e[38;5;19m"},
    {0x0000d7,"\e[38;5;20m"},
    {0x0000ff,"\e[38;5;21m"},
    {0x005f00,"\e[38;5;22m"},
    {0x005f5f,"\e[38;5;23m"},
    {0x005f87,"\e[38;5;24m"},
    {0x005faf,"\e[38;5;25m"},
    {0x005fd7,"\e[38;5;26m"},
    {0x005fff,"\e[38;5;27m"},
    {0x008700,"\e[38;5;28m"},
    {0x00875f,"\e[38;5;29m"},
    {0x008787,"\e[38;5;30m"},
    {0x0087af,"\e[38;5;31m"},
    {0x0087d7,"\e[38;5;32m"},
    {0x0087ff,"\e[38;5;33m"},
    {0x00af00,"\e[38;5;34m"},
    {0x00af5f,"\e[38;5;35m"},
    {0x00af87,"\e[38;5;36m"},
    {0x00afaf,"\e[38;5;37m"},
    {0x00afd7,"\e[38;5;38m"},
    {0x00afff,"\e[38;5;39m"},
    {0x00d700,"\e[38;5;40m"},
    {0x00d75f,"\e[38;5;41m"},
    {0x00d787,"\e[38;5;42m"},
    {0x00d7af,"\e[38;5;43m"},
    {0x00d7d7,"\e[38;5;44m"},
    {0x00d7ff,"\e[38;5;45m"},
    {0x00ff00,"\e[38;5;46m"},
    {0x00ff5f,"\e[38;5;47m"},
    {0x00ff87,"\e[38;5;48m"},
    {0x00ffaf,"\e[38;5;49m"},
    {0x00ffd7,"\e[38;5;50m"},
    {0x00ffff,"\e[38;5;51m"},
    {0x5f0000,"\e[38;5;52m"},
    {0x5f005f,"\e[38;5;53m"},
    {0x5f0087,"\e[38;5;54m"},
    {0x5f00af,"\e[38;5;55m"},
    {0x5f00d7,"\e[38;5;56m"},
    {0x5f00ff,"\e[38;5;57m"},
    {0x5f5f00,"\e[38;5;58m"},
    {0x5f5f5f,"\e[38;5;59m"},
    {0x5f5f87,"\e[38;5;60m"},
    {0x5f5faf,"\e[38;5;61m"},
    {0x5f5fd7,"\e[38;5;62m"},
    {0x5f5fff,"\e[38;5;63m"},
    {0x5f8700,"\e[38;5;64m"},
    {0x5f875f,"\e[38;5;65m"},
    {0x5f8787,"\e[38;5;66m"},
    {0x5f87af,"\e[38;5;67m"},
    {0x5f87d7,"\e[38;5;68m"},
    {0x5f87ff,"\e[38;5;69m"},
    {0x5faf00,"\e[38;5;70m"},
    {0x5faf5f,"\e[38;5;71m"},
    {0x5faf87,"\e[38;5;72m"},
    {0x5fafaf,"\e[38;5;73m"},
    {0x5fafd7,"\e[38;5;74m"},
    {0x5fafff,"\e[38;5;75m"},
    {0x5fd700,"\e[38;5;76m"},
    {0x5fd75f,"\e[38;5;77m"},
    {0x5fd787,"\e[38;5;78m"},
    {0x5fd7af,"\e[38;5;79m"},
    {0x5fd7d7,"\e[38;5;80m"},
    {0x5fd7ff,"\e[38;5;81m"},
    {0x5fff00,"\e[38;5;82m"},
    {0x5fff5f,"\e[38;5;83m"},
    {0x5fff87,"\e[38;5;84m"},
    {0x5fffaf,"\e[38;5;85m"},
    {0x5fffd7,"\e[38;5;86m"},
    {0x5fffff,"\e[38;5;87m"},
    {0x870000,"\e[38;5;88m"},
    {0x87005f,"\e[38;5;89m"},
    {0x870087,"\e[38;5;90m"},
    {0x8700af,"\e[38;5;91m"},
    {0x8700d7,"\e[38;5;92m"},
    {0x8700ff,"\e[38;5;93m"},
    {0x875f00,"\e[38;5;94m"},
    {0x875f5f,"\e[38;5;95m"},
    {0x875f87,"\e[38;5;96m"},
    {0x875faf,"\e[38;5;97m"},
    {0x875fd7,"\e[38;5;98m"},
    {0x875fff,"\e[38;5;99m"},
    {0x878700,"\e[38;5;100m"},
    {0x87875f,"\e[38;5;101m"},
    {0x878787,"\e[38;5;102m"},
    {0x8787af,"\e[38;5;103m"},
    {0x8787d7,"\e[38;5;104m"},
    {0x8787ff,"\e[38;5;105m"},
    {0x87af00,"\e[38;5;106m"},
    {0x87af5f,"\e[38;5;107m"},
    {0x87af87,"\e[38;5;108m"},
    {0x87afaf,"\e[38;5;109m"},
    {0x87afd7,"\e[38;5;110m"},
    {0x87afff,"\e[38;5;111m"},
    {0x87d700,"\e[38;5;112m"},
    {0x87d75f,"\e[38;5;113m"},
    {0x87d787,"\e[38;5;114m"},
    {0x87d7af,"\e[38;5;115m"},
    {0x87d7d7,"\e[38;5;116m"},
    {0x87d7ff,"\e[38;5;117m"},
    {0x87ff00,"\e[38;5;118m"},
    {0x87ff5f,"\e[38;5;119m"},
    {0x87ff87,"\e[38;5;120m"},
    {0x87ffaf,"\e[38;5;121m"},
    {0x87ffd7,"\e[38;5;122m"},
    {0x87ffff,"\e[38;5;123m"},
    {0xaf0000,"\e[38;5;124m"},
    {0xaf005f,"\e[38;5;125m"},
    {0xaf0087,"\e[38;5;126m"},
    {0xaf00af,"\e[38;5;127m"},
    {0xaf00d7,"\e[38;5;128m"},
    {0xaf00ff,"\e[38;5;129m"},
    {0xaf5f00,"\e[38;5;130m"},
    {0xaf5f5f,"\e[38;5;131m"},
    {0xaf5f87,"\e[38;5;132m"},
    {0xaf5faf,"\e[38;5;133m"},
    {0xaf5fd7,"\e[38;5;134m"},
    {0xaf5fff,"\e[38;5;135m"},
    {0xaf8700,"\e[38;5;136m"},
    {0xaf875f,"\e[38;5;137m"},
    {0xaf8787,"\e[38;5;138m"},
    {0xaf87af,"\e[38;5;139m"},
    {0xaf87d7,"\e[38;5;140m"},
    {0xaf87ff,"\e[38;5;141m"},
    {0xafaf00,"\e[38;5;142m"},
    {0xafaf5f,"\e[38;5;143m"},
    {0xafaf87,"\e[38;5;144m"},
    {0xafafaf,"\e[38;5;145m"},
    {0xafafd7,"\e[38;5;146m"},
    {0xafafff,"\e[38;5;147m"},
    {0xafd700,"\e[38;5;148m"},
    {0xafd75f,"\e[38;5;149m"},
    {0xafd787,"\e[38;5;150m"},
    {0xafd7af,"\e[38;5;151m"},
    {0xafd7d7,"\e[38;5;152m"},
    {0xafd7ff,"\e[38;5;153m"},
    {0xafff00,"\e[38;5;154m"},
    {0xafff5f,"\e[38;5;155m"},
    {0xafff87,"\e[38;5;156m"},
    {0xafffaf,"\e[38;5;157m"},
    {0xafffd7,"\e[38;5;158m"},
    {0xafffff,"\e[38;5;159m"},
    {0xd70000,"\e[38;5;160m"},
    {0xd7005f,"\e[38;5;161m"},
    {0xd70087,"\e[38;5;162m"},
    {0xd700af,"\e[38;5;163m"},
    {0xd700d7,"\e[38;5;164m"},
    {0xd700ff,"\e[38;5;165m"},
    {0xd75f00,"\e[38;5;166m"},
    {0xd75f5f,"\e[38;5;167m"},
    {0xd75f87,"\e[38;5;168m"},
    {0xd75faf,"\e[38;5;169m"},
    {0xd75fd7,"\e[38;5;170m"},
    {0xd75fff,"\e[38;5;171m"},
    {0xd78700,"\e[38;5;172m"},
    {0xd7875f,"\e[38;5;173m"},
    {0xd78787,"\e[38;5;174m"},
    {0xd787af,"\e[38;5;175m"},
    {0xd787d7,"\e[38;5;176m"},
    {0xd787ff,"\e[38;5;177m"},
    {0xd7af00,"\e[38;5;178m"},
    {0xd7af5f,"\e[38;5;179m"},
    {0xd7af87,"\e[38;5;180m"},
    {0xd7afaf,"\e[38;5;181m"},
    {0xd7afd7,"\e[38;5;182m"},
    {0xd7afff,"\e[38;5;183m"},
    {0xd7d700,"\e[38;5;184m"},
    {0xd7d75f,"\e[38;5;185m"},
    {0xd7d787,"\e[38;5;186m"},
    {0xd7d7af,"\e[38;5;187m"},
    {0xd7d7d7,"\e[38;5;188m"},
    {0xd7d7ff,"\e[38;5;189m"},
    {0xd7ff00,"\e[38;5;190m"},
    {0xd7ff5f,"\e[38;5;191m"},
    {0xd7ff87,"\e[38;5;192m"},
    {0xd7ffaf,"\e[38;5;193m"},
    {0xd7ffd7,"\e[38;5;194m"},
    {0xd7ffff,"\e[38;5;195m"},
    {0xff0000,"\e[38;5;196m"},
    {0xff005f,"\e[38;5;197m"},
    {0xff0087,"\e[38;5;198m"},
    {0xff00af,"\e[38;5;199m"},
    {0xff00d7,"\e[38;5;200m"},
    {0xff00ff,"\e[38;5;201m"},
    {0xff5f00,"\e[38;5;202m"},
    {0xff5f5f,"\e[38;5;203m"},
    {0xff5f87,"\e[38;5;204m"},
    {0xff5faf,"\e[38;5;205m"},
    {0xff5fd7,"\e[38;5;206m"},
    {0xff5fff,"\e[38;5;207m"},
    {0xff8700,"\e[38;5;208m"},
    {0xff875f,"\e[38;5;209m"},
    {0xff8787,"\e[38;5;210m"},
    {0xff87af,"\e[38;5;211m"},
    {0xff87d7,"\e[38;5;212m"},
    {0xff87ff,"\e[38;5;213m"},
    {0xffaf00,"\e[38;5;214m"},
    {0xffaf5f,"\e[38;5;215m"},
    {0xffaf87,"\e[38;5;216m"},
    {0xffafaf,"\e[38;5;217m"},
    {0xffafd7,"\e[38;5;218m"},
    {0xffafff,"\e[38;5;219m"},
    {0xffd700,"\e[38;5;220m"},
    {0xffd75f,"\e[38;5;221m"},
    {0xffd787,"\e[38;5;222m"},
    {0xffd7af,"\e[38;5;223m"},
    {0xffd7d7,"\e[38;5;224m"},
    {0xffd7ff,"\e[38;5;225m"},
    {0xffff00,"\e[38;5;226m"},
    {0xffff5f,"\e[38;5;227m"},
    {0xffff87,"\e[38;5;228m"},
    {0xffffaf,"\e[38;5;229m"},
    {0xffffd7,"\e[38;5;230m"},
    {0xffffff,"\e[38;5;231m"},
    {0x080808,"\e[38;5;232m"},
    {0x121212,"\e[38;5;233m"},
    {0x1c1c1c,"\e[38;5;234m"},
    {0x262626,"\e[38;5;235m"},
    {0x303030,"\e[38;5;236m"},
    {0x3a3a3a,"\e[38;5;237m"},
    {0x444444,"\e[38;5;238m"},
    {0x4e4e4e,"\e[38;5;239m"},
    {0x585858,"\e[38;5;240m"},
    {0x626262,"\e[38;5;241m"},
    {0x6c6c6c,"\e[38;5;242m"},
    {0x767676,"\e[38;5;243m"},
    {0x808080,"\e[38;5;244m"},
    {0x8a8a8a,"\e[38;5;245m"},
    {0x949494,"\e[38;5;246m"},
    {0x9e9e9e,"\e[38;5;247m"},
    {0xa8a8a8,"\e[38;5;248m"},
    {0xb2b2b2,"\e[38;5;249m"},
    {0xbcbcbc,"\e[38;5;250m"},
    {0xc6c6c6,"\e[38;5;251m"},
    {0xd0d0d0,"\e[38;5;252m"},
    {0xdadada,"\e[38;5;253m"},
    {0xe4e4e4,"\e[38;5;254m"},
    {0xeeeeee,"\e[38;5;255m"},
  };

uint32_t color_code(color_t c)
{
  return (c.r<<16)+(c.g<<8)+(c.b);
}

uint32_t color_dist(uint32_t c1,uint32_t c2)
{
  int32_t r=(c1>>16)&0xff-(c2>>16)&0xff;
  int32_t g=(c1>>8)&0xff-(c2>>8)&0xff;
  int32_t b=c1&0xff-c2&0xff;
  if(r<0)r*=-1;
  if(g<0)g*=-1;
  if(b<0)b*=-1;
  return r+g+b;
}

void change_color(color_t c)
{
  int i;
  uint32_t near=0xffffff;
  uint32_t index=-1;
  uint32_t code=color_code(c);
  uint32_t dist;
  for(i=0;i<256;i++)
    {
      dist=color_dist(code,color[i].code);
      if(dist<near)
	{
	  near=dist;
	  index=i;
	}
    }
  printf("%s",color[index].escape);
}
